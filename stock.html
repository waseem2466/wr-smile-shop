<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Stock - WR Smile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f9fafb;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 40px 30px;
      border-radius: 12px;
      box-shadow: 0 15px 40px rgba(33, 89, 243, 0.15);
    }
    h2 {
      text-align: center;
      font-weight: 700;
      color: #2159f3;
      margin-bottom: 2rem;
      letter-spacing: 1px;
    }
    input, button, select {
      transition: box-shadow 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #2159f3;
      box-shadow: 0 0 10px #2159f3a6;
      outline: none;
    }
    .btn-primary {
      background-color: #2159f3;
      border: none;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #1a47d4;
      transform: scale(1.05);
      box-shadow: 0 8px 30px rgba(33, 89, 243, 0.4);
    }
    table {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 35px rgba(33, 89, 243, 0.15);
      transition: box-shadow 0.3s ease;
      margin-top: 20px;
    }
    table thead {
      background-color: #2159f3;
      color: white;
      font-weight: 600;
    }
    tbody tr:hover {
      background-color: #e6f0ff;
      transition: all 0.3s ease;
    }
    .btn-danger {
      background-color: #e03e3e;
      border: none;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .btn-danger:hover {
      background-color: #b83030;
      transform: scale(1.1);
    }
  </style>
</head>
<body>

<div class="container">
  <h2>ðŸ“¦ Manage Stock</h2>
  
  <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#addProductModal">
    Add New Product
  </button>

  <table class="table table-bordered shadow-sm align-middle">
    <thead>
      <tr>
        <th>#</th>
        <th>Product Name</th>
        <th>Cost Price (Rs.)</th>
        <th>Selling Price (Rs.)</th>
        <th>Stock</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="stock-table-body"></tbody>
  </table>
</div>

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="add-product-form" class="modal-content" novalidate>
      <div class="modal-header">
        <h5 class="modal-title">Add New Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="productName" class="form-label">Product Name</label>
          <input id="productName" class="form-control" required />
          <div class="invalid-feedback">Please enter product name.</div>
        </div>
        <div class="mb-3">
          <label for="productCostPrice" class="form-label">Cost Price (Rs.)</label>
          <input id="productCostPrice" type="number" min="0" step="0.01" class="form-control" required />
          <div class="invalid-feedback">Please enter valid cost price.</div>
        </div>
        <div class="mb-3">
          <label for="productPrice" class="form-label">Selling Price (Rs.)</label>
          <input id="productPrice" type="number" min="0" step="0.01" class="form-control" required />
          <div class="invalid-feedback">Please enter valid selling price.</div>
        </div>
        <div class="mb-3">
          <label for="productStock" class="form-label">Stock Quantity</label>
          <input id="productStock" type="number" min="0" step="1" class="form-control" required />
          <div class="invalid-feedback">Please enter stock quantity.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Add Product</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyACehOi7n-dbdN00D4tJr2kD_-AVR6S-Vo",
    authDomain: "wr-smile-shop.firebaseapp.com",
    projectId: "wr-smile-shop",
    storageBucket: "wr-smile-shop.appspot.com",
    messagingSenderId: "299864260187",
    appId: "1:299864260187:web:fa6af65ef95674aff1097e"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const tbody = document.getElementById('stock-table-body');
  const addProductForm = document.getElementById('add-product-form');
  const addProductModalEl = document.getElementById('addProductModal');
  const addProductModal = new bootstrap.Modal(addProductModalEl);

  // Load and listen for product changes realtime
  function loadProducts() {
    db.ref('products').on('value', snapshot => {
      tbody.innerHTML = '';
      let index = 1;
      snapshot.forEach(child => {
        const product = child.val();
        tbody.innerHTML += `
          <tr>
            <td>${index++}</td>
            <td>${product.name}</td>
            <td>Rs. ${parseFloat(product.costPrice).toFixed(2)}</td>
            <td>Rs. ${parseFloat(product.price).toFixed(2)}</td>
            <td>${product.stock}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteProduct('${child.key}')">Delete</button>
            </td>
          </tr>
        `;
      });
    });
  }

  // Delete product
  function deleteProduct(id) {
    if (confirm('Are you sure you want to delete this product?')) {
      db.ref('products/' + id).remove()
      .catch(err => alert('Error deleting product: ' + err.message));
    }
  }

  // Add product form submit handler
  addProductForm.addEventListener('submit', e => {
    e.preventDefault();

    if (!addProductForm.checkValidity()) {
      addProductForm.classList.add('was-validated');
      return;
    }

    const name = document.getElementById('productName').value.trim();
    const costPrice = parseFloat(document.getElementById('productCostPrice').value);
    const price = parseFloat(document.getElementById('productPrice').value);
    const stock = parseInt(document.getElementById('productStock').value);

    if (!name || isNaN(costPrice) || isNaN(price) || isNaN(stock)) {
      alert('Please fill all fields correctly.');
      return;
    }

    // Push to Firebase
    db.ref('products').push({ name, costPrice, price, stock })
    .then(() => {
      // Reset form, remove validation styles, close modal
      addProductForm.reset();
      addProductForm.classList.remove('was-validated');
      addProductModal.hide();
    })
    .catch(error => {
      alert('Failed to add product: ' + error.message);
    });
  });

  // Expose deleteProduct globally for inline button handlers
  window.deleteProduct = deleteProduct;

  // Initial load products listener
  loadProducts();
</script>
</body>
</html>
